# 駅データ  
日本全国の鉄道路線・駅のデータベース編集プロジェクト  




## データの品質  
位置ゲーム【駅メモ！】内で使用されているデータベースに準拠

## データの出典  

* 駅データ.jp Copyright(c) CodePlus Co.,Ltd.  
サイト： http://www.ekidata.jp/  
基本的な路線・駅の名称・位置情報など

* 【駅メモ！】ステーションメモリーズ！情報wiki  
Copyright (c) 【駅メモ！】ステーションメモリーズ！情報wiki.  
サイト: https://ekimemo.wiki.fc2.com/  
上記の駅データ.jpとの差分をこちらの情報で埋める方針  

* 国土数値情報ダウンロードサービス  
http://nlftp.mlit.go.jp/ksj/index.html  
4.交通＞鉄道 2008/2017年度版  
鉄道路線のポリライン情報のみ

## データの更新
基本的に[運営からのお知らせ](https://ekimemo.com/news/)で公表される駅情報の更新に応じて同様の作業を実施。  
具体的な内容は[更新の記録](./history.md)に記述。  
なお現在の最新データのバージョン・場所等の情報は[このファイル](./latest_info.json)で定義されています。

# データの仕様  

## ディレクトリ構造
プロジェクト直下にデータのバージョンコード（半角数字8桁）と同じディレクトリが並んでいる。各バージョンでの完成データはoutディレクトリ以下を参照  
**注意**
* ファイルはすべてUTF-8でエンコーディングされたプレーンテキスト形式である
* バージョンはデータを更新した西暦年月日を0埋めで"YYYYMMDD"と表現したもの
```（例）バージョン20190101
20190101
  ├─ lines_raw.json     駅データ.jpからダウンロードしたままの路線データ
  ├─ stations_raw.json  駅データ.jpからダウンロードしたままの駅データ
  ├─ merge.json         駅データ.jpと駅メモのデータの差分を定義する
  ├─ lines.json     路線一覧データ
  ├─ stations.json  駅一覧データ
  └─ out
      ├─ lines.json     完成した路線詳細一覧データ
      ├─ stations.json  完成した駅詳細一覧データ
      └─ data.json      完成したデータの一つにまとめたもの
```

## データの詳細
### 駅データ
以下の属性をもつ  

|名前|値の型|値の内容|欠損の有無|  
|:-:|:-:|:--|:--|  
|code|整数値|各駅に固有な値|なし|  
|station|文字列|駅の名称|なし|  
|closed|真偽値|廃駅であるか|あり、falseの場合は省略|  
|phonetic|文字列|駅名称のひらがな表記|なし|  
|prefecture|整数値|駅の所在都道府県|なし|  
|lon|浮動小数|駅の所在経度|なし|  
|lat|浮動小数|駅の所在緯度|なし|  
|lines|配列（整数値の要素）|駅の登録されている路線コードのリスト|なし|  
|next|配列（整数値の要素）|隣接駅のコードのリスト|なし|  
|voronoi|オブジェクト|駅のボロノイ分割領域を表す|なし|  
  
**注意**
* 駅のコード（code）は原則として駅データ.jpに従う7桁の整数値。ただし、駅メモのみ実装の駅や新幹線駅など独自に追加した駅は区別して5000000番台を使う。
* 駅名の読み（phonetic）は駅名の部分のみに対応する。  
	* 高砂(北海道):たかさご　駅名のうち重複を避けるための接尾語（駅メモでは所在都道府県または事業者名）は無視する
	* 明治神宮前〈原宿〉:めいじじんぐうまえ(はらじゅく) のように平仮名以外も含む例外もある
* 所在都道府県(prefecture)は[都道府県コード](./prefecture.csv)を参照
* 各駅は必ず1つ以上の路線に登録されているので"line"の配列は空ではない

### 路線データ
以下の属性をもつ  

|名前|値の型|値の内容|欠損の有無|  
|:-:|:-:|:--|:--|  
|code|整数値|各路線に固有な値|なし|  
|line|文字列|路線の名称|なし|  
|closed|真偽値|廃線であるか|あり、falseの場合は省略|  
|phonetic|文字列|路線名称のひらがな表記|なし|  
|symbol|文字列|路線記号|あり|  
|color|文字列|路線カラー|あり|  
|list_size|整数値|路線に登録された駅数|なし|  
  
**注意**
* 路線のコード（code）は原則として駅データ.jpに従う5桁の整数値。ただし、駅メモのみ実装の路線や新幹線など独自に追加した駅は区別して50000番台を使う。
* 路線の読み（phonetic）は、JR根室本線(花咲線)(釧路～根室):じぇいあーるねむろほんせん(はなせきせん) のように区間を区別する接尾語は無視するが愛称・別名は括弧付きで添付することがある。
* 路線コード（symbol）に関して、ここで区分される一つの路線が異なる複数の路線コードから成る場合は欠損扱いにしている。路線カラーも同様である。  
	（例）JR函館本線(函館～長万部)の路線記号は本線：H、砂原支線：Nなので欠損あつかい
* 路線カラーの色はRGB表現で"#[0-9A-F]{6}"の16進数で表す

## ボロノイ分割の計算に関して  
**ボロノイ分割とは？**  
平面状の各点から最も距離が近い座標の駅がどれかという基準で平面全体を分割する方法、もしくはその分割における境界線の集合とここでは定義しておきます。  

**平面への投影方法**  
計算に際して地球表面という曲面上の各点を平面へ投影してから分割を計算している。緯度経度で指定された各駅の座標(lat/lng)を次の変換でxy直交座標平面に写す。  
x = lng, y = lat  
  
**注意**  
投影された平面上での距離と実際の地表面上での距離は大小関係が保存されない。高緯度では東西方向の距離が実際よりも過大評価される。しかし、駅メモでは緯度経度でユークリッド距離を計算して近い遠いの比較をするヤバめ実装らしいので合わせておく。

## 駅の座標
駅データ.jpに登録がある（新幹線を除く）ならば原則としてその値を参照する。それ以外の駅の座標は次の方法で調べた。
  
* 駅メモでは駅の座標を直接確認する方法はない（多分？）
* 地図上では確認はできる
* GoogleMap上でzoom=18.00（2019年06月現在）
  
そこで地図上で表示した画像と緯度経度既知のGoogleMap画像をテンプレートマッチして対応する座標を推定する。  
  
予想される数値の誤差範囲（JR東海道本線、東京～小田原16駅で計算）  
lng: 2.1249999981876044e-06  
lat: 3.437499999758842e-06  